[pipeline]
name = "default_pdk_flow"
description = "genus synth + innovus init/place + harvest"
default_target = "harvest"
schema_version = "1"

[conventions]
stages_dir = "stages"
status_file = "status.json"

[[stage]]
name = "synth"
order = 10
depends_on = []
inputs = ["run.toml", "inputs/design/*", "inputs/tech/*"]
outputs = [
  "stages/10_synth/outputs/netlist.v",
]

[stage.exec]
argv = ["genus", "-batch", "-files", "../../scripts/synth.tcl"]

[[stage]]
name = "init"
order = 20
depends_on = ["synth"]
inputs = [
  "stages/10_synth/outputs/netlist.v",
]
outputs = ["stages/20_init/outputs/design.enc"]

[stage.exec]
argv = ["innovus", "-batch", "-files", "../../scripts/init.tcl"]

[[stage]]
name = "place"
order = 30
depends_on = ["init"]
inputs = ["stages/20_init/outputs/design.enc"]
outputs = ["stages/30_place/outputs/design.enc"]

[stage.exec]
argv = ["innovus", "-batch", "-files", "../../scripts/place.tcl"]

[[stage]]
name = "route"
order = 40
depends_on = ["place"]
inputs = ["stages/30_place/outputs/design.enc"]
outputs = ["stages/40_route/outputs/design.enc"]

[stage.exec]
argv = ["innovus", "-batch", "-files", "../../scripts/route.tcl"]

[[stage]]
name = "harvest"
order = 99
depends_on = ["route"]
inputs = ["stages/40_route/outputs/design.enc"]
outputs = ["outputs/harvest.json"]

[stage.exec]
argv = ["python3", "../../scripts/harvest.py", "--in", "../../stages/40_route/outputs/design.enc", "--out", "../../outputs/harvest.json"]
