# Project: PFXFlow

## 0. Meta & Status

-   **Spec version:** v0.8.3
-   **Owner:** Paul Gutwin
-   **Doc status:** Draft (Master Specification)
-   2026-02-05

### Change Log

-   2026-02-05 -- Integrated DOE variable propagation via pfx_vars.tcl
    (v0.8.3)
-   2026-02-04 -- Prior changes (see v0.8.2)

------------------------------------------------------------------------

# (This document is based on v0.8.2 and integrates Variable Propagation Delta)

## 3.12 Variable Propagation Model (v1)

### 3.12.1 Purpose

Defines the normative mechanism by which DOE and run variables are
propagated from run.toml into Tcl via pfx_vars.tcl. Owned by PFXCore.

Wrappers SHALL NOT parse run.toml.

### 3.12.2 Responsibilities

#### PFXStudy

-   Generates run.toml
-   Populates DOE, design, technology, and user variables

#### PFXCore

-   Parses run.toml
-   Generates pfx_vars.tcl under each stage
-   Ensures it is sourced

#### Wrappers

-   Execute entry scripts
-   Do not translate variables

### 3.12.3 run.toml Variable Sections

Mandatory sections:

-   \[run\]
-   \[doe\]
-   \[design\]
-   \[technology\]

Optional: - \[vars\] - \[paths\]

### 3.12.4 Tcl Mapping Rules

All variables are placed in associative array:

    pfx(...)

Format:

    set pfx(section.key) value

Mapping:

  TOML    Tcl
  ------- -------
  int     int
  float   float
  bool    0/1
  str     "..."

### 3.12.5 Reserved Variables

Always present:

-   pfx(run.run_id)
-   pfx(run.study_name)
-   pfx(run.semantic_path)

### 3.12.6 File Format

Header:

# Auto-generated by PFXCore

# Source: run.toml

# Do not edit

Each variable:

set pfx(name) value

### 3.12.7 Entry Script

If enabled:

source pfx_vars.tcl source scripts/`<stage>`{=html}.tcl

### 3.12.8 Compliance

v1 implementations MUST support this mechanism.

------------------------------------------------------------------------

(Other sections remain unchanged from v0.8.2 and are incorporated by
reference.)
